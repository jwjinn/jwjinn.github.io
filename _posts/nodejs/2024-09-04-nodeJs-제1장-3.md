---
title: 1.1.3 이벤트 기반
description: NodeJs의 이벤트 기반을 정리합니다.
date: 24-09-04
categories: [nodeJs, 1장]
tags: [NodeJs]
pin: true
math: true
mermaid: true

---

# 이벤트 기반이란?

- 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미합니다. 이벤트로는 클릭과 네트워크 요청이 있을 수도 있습니다.

특정 이벤트가 발생을 하면, 그에 따른 콜백함수가 실행되는 형식이 기본 패턴입니다.

제공되는 메서드들은 이벤트 기반 형식을 따르고 있고 추가적으로 메서드를 만들 경우, 동일한 형식을 취해야 제대로 활용을 할 수 있다고 생각합니다.

## 실행 방식의 차별점:

- 코드를 위에서 부터 실행되는 보통의 엔진과 달리 `이벤트 기반`입니다. 따라서, 어떠한 이벤트가 발생할 때 무엇을 할지 미리 등록해둬야 합니다.

그렇기에 함수의 위치를 자바스크립트의 하단에 정의를 해두어도 상관이 없습니다.

`이벤트 발생 -> 콜백 함수 호출 -> 정의 함수 코드 읽고 실행` 과 같은 순서로 실행이 되기 때문이죠. 

> - 어떠한 이벤트가 발생할때 -> '이벤트 리스너' 등록
> - 무엇을 할지 -> '콜백 함수' 등록
{: .prompt-info }

***

## 이벤트 루프:

- 여러 이벤트가 동시에 발생했을 때 `어떤 순서로 콜백 함수를 호출`할지를 이벤트 루프가 판단합니다.

이를 위해서 '이벤트 루프' 라는 개념이 등장하게 되었고 아래는 이벤트 루프의 시작인 '호출 스택'을 설명합니다.

```javascript

function first() {
  second();
  console.log('첫 번째');
}
function second() {
  third();
  console.log('두 번째');
}
function third() {
  console.log('세 번째');
}
first();

```

이런 식으로 코드가 짜여지고 실행이 될 경우에는 `anonymoouse -> first() -> second() -> third()` 순서로 호출 스택에 들어가게 됩니다.

그리고 스택이기에 역순으로 실행이 되게 됩니다.

아직은 호출스택에 함수를 넣고 실행하는 것이 그만입니다. 아래와 같이 `setTimeout`이 추가가 된다면 호출 스택만으로는 설명이 불가합니다.

### setTimeout을 사용한 경우

```javascript

function run() { 
  console.log('3초 후 실행');
}
console.log('시작');
setTimeout(run, 3000);
 
console.log('끝');

```

## setTimeout 실행 과정을 살펴보자.

-  이벤트 루프: 이벤트 발생 시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당합니다. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프(loop)라고 부릅니다.

-  백그라운드: setTimeout 같은 타이머나 이벤트 리스너들이 대기하는 곳입니다. 자바스크립트가 아닌 다른 언어로 작성된 프로그램이라고 봐도 무방하며, 여러 작업이 동시에 실행될 수 있습니다.

-  태스크 큐: 이벤트 발생 후, 백그라운드에서는 `태스크 큐로 타이머나 이벤트 리스너의 콜백 함수`를 보냅니다. 정해진 순서대로 콜백들이 줄을 서 있으므로 콜백 큐라고도 합니다. 콜백들은 보통 완료된 순서대로 줄을 서 있지만, 특정한 경우 순서가 바뀌기도 합니다.

다른 말들은 끄덕끄덕 이해를 할 수 있지만, 태스크 큐는 생각이 저의 경우 필요했습니다.

> 1. 호출 스택에서는 `setTimeout(run, 3000)` 이라는 함수가 들어가게 됩니다.<br>
> 2. 함수가 호출 스택에서 실행이 되면, setTimeout의 `콜백 함수와 타이밍 정보`들은 `백그라운드`로 들어가게 됩니다.<br>
> 3. 백그라운드에서는 파일을 읽는 경우에는 다 읽거나, setTimeout의 경우에는 타이머가 다 될 경우, 콜백 함수(ex: run)를 태스크 큐로 전달합니다.
{: .prompt-info }

해당 과정을 통해서, 백그라운드까지 들어간 콜백함수가 태스크 큐까지 들어가게 되었습니다.

### 태스크 큐의 실행

처음의 예시로 호출 스택에서 빠져나가면서 함수가 실행되는 것을 보았습니다.

그렇다면, 태스크 큐에 있는 함수가 언제 호출 스택에 올려지는 지를 살펴봐야 합니다.

> 1. 호출 스택이 비워져야 합니다.<br>
> 2. 호출 스택이 비워지면 이벤트 루프가 태스크 큐에 있는 콜백을 호출 스택으로 올립니다.<br>
> 3. 그러고 올려진 호출 스택이 실행되고 제거가 됩니다.
{: .prompt-info }

이러한 방식으로 실행이 되기에, 호출 스택이 많이 쌓여 있다면, `setTimeout`으로 설정된 타이밍이 정확하지 않을 수 있습니다.